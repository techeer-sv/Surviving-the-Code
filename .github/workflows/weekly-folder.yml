name: ğŸ“ Weekly Folder Creation

on:
  schedule:
    # ë§¤ì£¼ ì›”ìš”ì¼ 03:30 KST (ì¼ìš”ì¼ 18:20 UTC)ì— ì‹¤í–‰
    - cron: '35 18 * * 0'
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥í•˜ë„ë¡

jobs:
  create-weekly-folder:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: ğŸ” Find Latest Week Number
      id: find_week
      run: |
        # ë©¤ë²„ í´ë” ëª©ë¡
        members=("juha" "jugwang" "kihong" "jimin" "minseon" "seojimin", "jongmine")
        
        # ê°€ì¥ í° week ë²ˆí˜¸ ì°¾ê¸°
        max_week=0
        for member in "${members[@]}"; do
          if [ -d "$member" ]; then
            # ê° ë©¤ë²„ í´ë” ë‚´ì˜ week í´ë” ì°¾ê¸°
            week_folders=$(find "$member" -type d -name "week*" | grep -E "week[0-9]+" || true)
            
            for folder in $week_folders; do
              week_num=$(echo $folder | grep -o '[0-9]\+')
              if [ "$week_num" -gt "$max_week" ]; then
                max_week=$week_num
              fi
            done
          fi
        done
        
        # ë‹¤ìŒ week ë²ˆí˜¸ ê³„ì‚°
        next_week=$((max_week + 1))
        echo "next_week=$next_week" >> $GITHUB_OUTPUT
        echo "ğŸ“Š Current highest week number: $max_week"
        echo "ğŸ“ Next week number to create: $next_week"

    - name: ğŸ“ Create New Week Folders
      run: |
        next_week=${{ steps.find_week.outputs.next_week }}
        
        # ê° ë©¤ë²„ì˜ í´ë”ì— ìƒˆë¡œìš´ week í´ë” ìƒì„±
        for member in juha jugwang kihong jimin minseon seojimin jongmine; do
          if [ -d "$member" ]; then
            week_folder="$member/week$next_week"
            if [ ! -d "$week_folder" ]; then
              mkdir -p "$week_folder"
              # README.md íŒŒì¼ ìƒì„±
              echo "# Week $next_week" > "$week_folder/README.md"
              echo "Created on $(date '+%Y-%m-%d')" >> "$week_folder/README.md"
              echo "âœ… Created $week_folder with README.md"
            else
              echo "â„¹ï¸ $week_folder already exists"
            fi
          else
            echo "âš ï¸ $member folder not found"
          fi
        done

    - name: ğŸ“ Commit and Push Changes
      run: |
        git config --global user.name 'GitHub Actions'
        git config --global user.email 'actions@github.com'
        
        # ë³€ê²½ì‚¬í•­ì´ ìˆëŠ”ì§€ í™•ì¸
        if git status --porcelain | grep -q '^'; then
          git add .
          git commit -m "ğŸ“ Create week${{ steps.find_week.outputs.next_week }} folders"
          git push
        else
          echo "No changes to commit"
        fi 
